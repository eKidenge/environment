{% extends 'base.html' %}
{% load static %}

{% block title %}{{ program.title }} - EcoHub Program{% endblock %}

{% block extra_css %}
<style>
    .program-hero {
        background: linear-gradient(135deg, #10b981 0%, #0d9488 100%);
    }
    
    .module-card {
        transition: all 0.2s ease;
        border-left: 4px solid transparent;
    }
    
    .module-card:hover {
        transform: translateX(5px);
        border-left-color: #10b981;
        background-color: #f0fdf4;
    }
    
    .module-card.completed {
        border-left-color: #10b981;
        background-color: #f0fdf4;
    }
    
    .module-card.current {
        border-left-color: #3b82f6;
        background-color: #eff6ff;
    }
    
    .progress-ring {
        transform: rotate(-90deg);
    }
    
    .progress-ring-circle {
        stroke-dasharray: 283;
        stroke-dashoffset: 283;
        transition: stroke-dashoffset 1s ease;
    }
    
    .instructor-avatar {
        width: 80px;
        height: 80px;
        border: 4px solid white;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .requirement-badge {
        font-size: 0.75rem;
        padding: 0.25rem 0.75rem;
    }
    
    .stat-card {
        transition: all 0.3s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px -5px rgba(16, 185, 129, 0.1);
    }
    
    .syllabus-item {
        counter-increment: syllabus;
    }
    
    .syllabus-item::before {
        content: counter(syllabus);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 28px;
        height: 28px;
        background-color: #10b981;
        color: white;
        border-radius: 50%;
        margin-right: 12px;
        font-size: 0.875rem;
        font-weight: 600;
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <!-- Program Hero -->
    <div class="program-hero text-white">
        <div class="container mx-auto px-4 py-12">
            <div class="max-w-6xl mx-auto">
                <!-- Breadcrumb -->
                <nav class="mb-6">
                    <ol class="flex items-center space-x-2 text-sm text-emerald-100">
                        <li>
                            <a href="{% url 'core:home' %}" class="hover:text-white">Home</a>
                        </li>
                        <li><i class="fas fa-chevron-right text-xs"></i></li>
                        <li>
                            <a href="{% url 'programs:list' %}" class="hover:text-white">Programs</a>
                        </li>
                        <li><i class="fas fa-chevron-right text-xs"></i></li>
                        <li>
                            <a href="{% url 'programs:list' %}?category={{ program.category.slug }}" class="hover:text-white">
                                {{ program.category.name }}
                            </a>
                        </li>
                        <li><i class="fas fa-chevron-right text-xs"></i></li>
                        <li class="text-white font-medium">{{ program.title|truncatechars:40 }}</li>
                    </ol>
                </nav>
                
                <div class="flex flex-col lg:flex-row items-start lg:items-center justify-between mb-8">
                    <div class="lg:w-2/3 mb-8 lg:mb-0">
                        <!-- Badges -->
                        <div class="flex flex-wrap gap-2 mb-4">
                            {% if program.is_featured %}
                            <span class="px-3 py-1 bg-white/20 backdrop-blur-sm rounded-full text-sm">
                                <i class="fas fa-star mr-1"></i>
                                Featured
                            </span>
                            {% endif %}
                            {% if program.is_new %}
                            <span class="px-3 py-1 bg-white/20 backdrop-blur-sm rounded-full text-sm">
                                <i class="fas fa-bolt mr-1"></i>
                                New
                            </span>
                            {% endif %}
                            {% if program.is_certified %}
                            <span class="px-3 py-1 bg-white/20 backdrop-blur-sm rounded-full text-sm">
                                <i class="fas fa-certificate mr-1"></i>
                                Certification
                            </span>
                            {% endif %}
                            <span class="px-3 py-1 bg-white/20 backdrop-blur-sm rounded-full text-sm">
                                {{ program.get_difficulty_display }}
                            </span>
                        </div>
                        
                        <!-- Title -->
                        <h1 class="text-4xl md:text-5xl font-bold mb-4">{{ program.title }}</h1>
                        
                        <!-- Description -->
                        <p class="text-xl text-emerald-100 mb-6">{{ program.short_description }}</p>
                        
                        <!-- Stats -->
                        <div class="flex flex-wrap items-center gap-6">
                            <div class="flex items-center">
                                <i class="fas fa-users mr-2"></i>
                                <span>{{ program.enrolled_count|default:"0" }} enrolled</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-star text-amber-300 mr-2"></i>
                                <span>{{ program.rating|default:"4.5" }}/5.0 ({{ program.review_count|default:"0" }} reviews)</span>
                            </div>
                            <div class="flex items-center">
                                <i class="far fa-clock mr-2"></i>
                                <span>{{ program.duration }} weeks • {{ program.total_hours }} hours</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Enrollment CTA -->
                    <div class="lg:w-1/3">
                        <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6">
                            {% if program.is_free %}
                            <div class="text-center mb-6">
                                <span class="text-4xl font-bold">Free</span>
                                <p class="text-emerald-100">No cost to enroll</p>
                            </div>
                            {% else %}
                            <div class="text-center mb-6">
                                <span class="text-4xl font-bold">${{ program.price }}</span>
                                <p class="text-emerald-100">One-time payment</p>
                            </div>
                            {% endif %}
                            
                            <div class="space-y-3">
                                {% if user_enrolled %}
                                <a href="#continue" class="w-full btn bg-white text-emerald-700 hover:bg-gray-100">
                                    <i class="fas fa-play-circle mr-2"></i>
                                    Continue Learning
                                </a>
                                {% else %}
                                <a href="{% url 'programs:apply' program.id %}" class="w-full btn bg-white text-emerald-700 hover:bg-gray-100">
                                    <i class="fas fa-rocket mr-2"></i>
                                    Enroll Now
                                </a>
                                {% endif %}
                                
                                <button class="w-full btn bg-transparent border-2 border-white text-white hover:bg-white/10">
                                    <i class="far fa-heart mr-2"></i>
                                    Add to Wishlist
                                </button>
                                
                                <button class="w-full btn bg-transparent border-2 border-white text-white hover:bg-white/10">
                                    <i class="fas fa-share-alt mr-2"></i>
                                    Share Program
                                </button>
                            </div>
                            
                            <!-- Guarantee -->
                            <div class="mt-6 pt-6 border-t border-white/20">
                                <div class="flex items-center text-sm text-emerald-100">
                                    <i class="fas fa-shield-alt mr-3"></i>
                                    <span>30-day satisfaction guarantee</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-12">
        <div class="max-w-6xl mx-auto">
            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Left Column -->
                <div class="lg:w-2/3">
                    <!-- Navigation Tabs -->
                    <div class="bg-white rounded-2xl shadow-lg mb-6">
                        <div class="border-b border-gray-200">
                            <nav class="flex space-x-8 px-6 overflow-x-auto">
                                <a href="#overview" class="tab-link py-4 font-medium text-gray-500 hover:text-emerald-600 whitespace-nowrap">
                                    <i class="fas fa-info-circle mr-2"></i>
                                    Overview
                                </a>
                                <a href="#curriculum" class="tab-link py-4 font-medium text-gray-500 hover:text-emerald-600 whitespace-nowrap">
                                    <i class="fas fa-list-ol mr-2"></i>
                                    Curriculum
                                </a>
                                <a href="#instructor" class="tab-link py-4 font-medium text-gray-500 hover:text-emerald-600 whitespace-nowrap">
                                    <i class="fas fa-chalkboard-teacher mr-2"></i>
                                    Instructor
                                </a>
                                <a href="#reviews" class="tab-link py-4 font-medium text-gray-500 hover:text-emerald-600 whitespace-nowrap">
                                    <i class="fas fa-star mr-2"></i>
                                    Reviews
                                </a>
                                <a href="#faq" class="tab-link py-4 font-medium text-gray-500 hover:text-emerald-600 whitespace-nowrap">
                                    <i class="fas fa-question-circle mr-2"></i>
                                    FAQ
                                </a>
                            </nav>
                        </div>
                    </div>

                    <!-- Overview Section -->
                    <section id="overview" class="mb-12">
                        <div class="bg-white rounded-2xl shadow-lg p-8">
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">About This Program</h2>
                            
                            <div class="prose max-w-none text-gray-600 mb-8">
                                {{ program.description|safe }}
                            </div>
                            
                            <!-- What You'll Learn -->
                            <div class="mb-8">
                                <h3 class="text-xl font-bold text-gray-800 mb-4">What You'll Learn</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {% for learning_point in program.learning_points.all %}
                                    <div class="flex items-start space-x-3">
                                        <div class="flex-shrink-0 w-6 h-6 bg-emerald-100 rounded-full flex items-center justify-center mt-1">
                                            <i class="fas fa-check text-emerald-600 text-xs"></i>
                                        </div>
                                        <span class="text-gray-700">{{ learning_point.point }}</span>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            
                            <!-- Who This Program Is For -->
                            <div>
                                <h3 class="text-xl font-bold text-gray-800 mb-4">Who This Program Is For</h3>
                                <div class="bg-emerald-50 rounded-xl p-6">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        {% for target in program.target_audience.all %}
                                        <div class="flex items-center">
                                            <i class="fas fa-check text-emerald-600 mr-3"></i>
                                            <span class="text-gray-700">{{ target.description }}</span>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Curriculum Section -->
                    <section id="curriculum" class="mb-12">
                        <div class="bg-white rounded-2xl shadow-lg p-8">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold text-gray-800">Curriculum</h2>
                                <div class="text-gray-600">
                                    <span class="font-medium">{{ program.modules.count }} modules</span>
                                    <span class="mx-2">•</span>
                                    <span>{{ program.total_hours }} hours</span>
                                </div>
                            </div>
                            
                            <!-- Progress Summary -->
                            {% if user_enrolled %}
                            <div class="bg-gray-50 rounded-xl p-6 mb-8">
                                <div class="flex items-center justify-between mb-4">
                                    <div>
                                        <h3 class="font-bold text-gray-800">Your Progress</h3>
                                        <p class="text-sm text-gray-600">Continue where you left off</p>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-2xl font-bold text-emerald-600">{{ user_progress }}%</div>
                                        <div class="text-sm text-gray-600">Complete</div>
                                    </div>
                                </div>
                                <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                                    <div class="h-full bg-emerald-500 rounded-full" style="width: {{ user_progress }}%"></div>
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- Modules -->
                            <div class="space-y-4">
                                {% for module in program.modules.all %}
                                <div class="module-card rounded-xl border border-gray-200 p-6 
                                    {% if module.completed %}completed{% endif %}
                                    {% if module.is_current %}current{% endif %}">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <div class="flex items-center mb-2">
                                                <h3 class="text-lg font-semibold text-gray-800 mr-3">{{ module.title }}</h3>
                                                {% if module.completed %}
                                                <span class="px-2 py-1 bg-emerald-100 text-emerald-800 text-xs rounded-full">
                                                    <i class="fas fa-check mr-1"></i>
                                                    Completed
                                                </span>
                                                {% elif module.is_current %}
                                                <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">
                                                    <i class="fas fa-play mr-1"></i>
                                                    Continue Here
                                                </span>
                                                {% endif %}
                                            </div>
                                            <p class="text-gray-600 text-sm mb-3">{{ module.description }}</p>
                                            
                                            <div class="flex flex-wrap items-center gap-4 text-sm text-gray-500">
                                                <div class="flex items-center">
                                                    <i class="far fa-clock mr-2"></i>
                                                    {{ module.duration }} minutes
                                                </div>
                                                <div class="flex items-center">
                                                    <i class="fas fa-play-circle mr-2"></i>
                                                    {{ module.lessons.count }} lessons
                                                </div>
                                                {% if module.has_resources %}
                                                <div class="flex items-center">
                                                    <i class="fas fa-download mr-2"></i>
                                                    Resources
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        
                                        <div class="ml-4">
                                            {% if module.is_locked and not user_enrolled %}
                                            <i class="fas fa-lock text-gray-400 text-xl"></i>
                                            {% else %}
                                            <button class="btn btn-outline btn-sm">
                                                {% if module.completed %}
                                                <i class="fas fa-redo mr-2"></i>
                                                Review
                                                {% else %}
                                                <i class="fas fa-play mr-2"></i>
                                                Start
                                                {% endif %}
                                            </button>
                                            {% endif %}
                                        </div>
                                    </div>
                                    
                                    <!-- Lessons (collapsible) -->
                                    {% if module.lessons.exists %}
                                    <div class="mt-4 pl-12">
                                        <div class="space-y-2">
                                            {% for lesson in module.lessons.all %}
                                            <div class="flex items-center justify-between py-2 px-3 bg-gray-50 rounded-lg">
                                                <div class="flex items-center">
                                                    <div class="w-6 h-6 rounded-full border border-gray-300 flex items-center justify-center mr-3">
                                                        {% if lesson.completed %}
                                                        <i class="fas fa-check text-emerald-600 text-xs"></i>
                                                        {% else %}
                                                        <span class="text-xs text-gray-500">{{ forloop.counter }}</span>
                                                        {% endif %}
                                                    </div>
                                                    <span class="text-sm text-gray-700">{{ lesson.title }}</span>
                                                </div>
                                                <div class="text-xs text-gray-500">
                                                    {{ lesson.duration }} min
                                                </div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            </div>
                            
                            <!-- Prerequisites -->
                            {% if program.prerequisites.exists %}
                            <div class="mt-8 pt-8 border-t border-gray-200">
                                <h3 class="text-xl font-bold text-gray-800 mb-4">Prerequisites</h3>
                                <div class="space-y-2">
                                    {% for prereq in program.prerequisites.all %}
                                    <div class="flex items-center">
                                        <i class="fas fa-check-circle text-emerald-500 mr-3"></i>
                                        <span class="text-gray-700">{{ prereq.description }}</span>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </section>

                    <!-- Instructor Section -->
                    <section id="instructor" class="mb-12">
                        <div class="bg-white rounded-2xl shadow-lg p-8">
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">Meet Your Instructor</h2>
                            
                            <div class="flex flex-col md:flex-row items-start md:items-center space-y-6 md:space-y-0 md:space-x-8">
                                <!-- Instructor Avatar -->
                                <div class="flex-shrink-0">
                                    <div class="instructor-avatar rounded-full overflow-hidden">
                                        {% if program.instructor.avatar %}
                                        <img src="{{ program.instructor.avatar.url }}" 
                                             alt="{{ program.instructor.name }}" 
                                             class="w-full h-full object-cover">
                                        {% else %}
                                        <div class="w-full h-full bg-gradient-to-r from-emerald-400 to-teal-500 flex items-center justify-center">
                                            <span class="text-2xl font-bold text-white">{{ program.instructor.name|first|upper }}</span>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <!-- Instructor Info -->
                                <div class="flex-1">
                                    <h3 class="text-2xl font-bold text-gray-800 mb-2">{{ program.instructor.name }}</h3>
                                    <p class="text-lg text-gray-600 mb-4">{{ program.instructor.title }}</p>
                                    
                                    <div class="flex items-center space-x-6 mb-4">
                                        <div class="flex items-center">
                                            <i class="fas fa-star text-amber-400 mr-2"></i>
                                            <span class="text-gray-700">{{ program.instructor.rating }}/5 Instructor Rating</span>
                                        </div>
                                        <div class="flex items-center">
                                            <i class="fas fa-users mr-2 text-blue-500"></i>
                                            <span class="text-gray-700">{{ program.instructor.students_count }} Students</span>
                                        </div>
                                    </div>
                                    
                                    <p class="text-gray-600 mb-6">{{ program.instructor.bio|truncatewords:60 }}</p>
                                    
                                    <div class="flex space-x-3">
                                        <a href="#" class="text-blue-600 hover:text-blue-700 font-medium">
                                            <i class="fab fa-linkedin mr-1"></i>
                                            LinkedIn
                                        </a>
                                        <a href="#" class="text-gray-600 hover:text-gray-700 font-medium">
                                            <i class="fas fa-globe mr-1"></i>
                                            Website
                                        </a>
                                        <a href="#" class="text-purple-600 hover:text-purple-700 font-medium">
                                            <i class="fas fa-graduation-cap mr-1"></i>
                                            Other Programs
                                        </a>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Instructor Stats -->
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8">
                                <div class="stat-card bg-gray-50 rounded-xl p-4 text-center">
                                    <div class="text-2xl font-bold text-gray-800 mb-1">{{ program.instructor.programs_count }}</div>
                                    <div class="text-sm text-gray-600">Programs</div>
                                </div>
                                <div class="stat-card bg-gray-50 rounded-xl p-4 text-center">
                                    <div class="text-2xl font-bold text-gray-800 mb-1">{{ program.instructor.reviews_count }}</div>
                                    <div class="text-sm text-gray-600">Reviews</div>
                                </div>
                                <div class="stat-card bg-gray-50 rounded-xl p-4 text-center">
                                    <div class="text-2xl font-bold text-gray-800 mb-1">{{ program.instructor.experience_years }}+</div>
                                    <div class="text-sm text-gray-600">Years Experience</div>
                                </div>
                                <div class="stat-card bg-gray-50 rounded-xl p-4 text-center">
                                    <div class="text-2xl font-bold text-gray-800 mb-1">{{ program.instructor.students_count }}</div>
                                    <div class="text-sm text-gray-600">Students</div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Reviews Section -->
                    <section id="reviews" class="mb-12">
                        <div class="bg-white rounded-2xl shadow-lg p-8">
                            <div class="flex justify-between items-center mb-6">
                                <div>
                                    <h2 class="text-2xl font-bold text-gray-800">Student Reviews</h2>
                                    <div class="flex items-center mt-2">
                                        <div class="flex items-center mr-4">
                                            <span class="text-3xl font-bold text-gray-800 mr-2">{{ program.rating }}</span>
                                            <div class="text-amber-400">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star-half-alt"></i>
                                            </div>
                                        </div>
                                        <span class="text-gray-600">{{ program.review_count }} reviews</span>
                                    </div>
                                </div>
                                
                                <button class="btn btn-primary">
                                    <i class="fas fa-pen mr-2"></i>
                                    Write a Review
                                </button>
                            </div>
                            
                            <!-- Rating Distribution -->
                            <div class="mb-8">
                                <h3 class="font-bold text-gray-800 mb-4">Rating Distribution</h3>
                                <div class="space-y-2">
                                    {% for i in "54321" %}
                                    <div class="flex items-center">
                                        <span class="w-8 text-sm text-gray-600">{{ i }} star{{ i|pluralize }}</span>
                                        <div class="flex-1 mx-3">
                                            <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                                                <div class="h-full bg-amber-400 rounded-full" 
                                                     style="width: {% widthratio forloop.counter 1 20 %}%"></div>
                                            </div>
                                        </div>
                                        <span class="w-8 text-sm text-gray-600">{% widthratio forloop.counter 1 20 %}%</span>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            
                            <!-- Reviews -->
                            <div class="space-y-6">
                                {% for review in program.recent_reviews %}
                                <div class="border-b border-gray-200 pb-6 last:border-0 last:pb-0">
                                    <div class="flex items-start justify-between mb-3">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 rounded-full overflow-hidden mr-3">
                                                {% if review.user.avatar %}
                                                <img src="{{ review.user.avatar.url }}" 
                                                     alt="{{ review.user.get_full_name }}" 
                                                     class="w-full h-full object-cover">
                                                {% else %}
                                                <div class="w-full h-full bg-gradient-to-r from-blue-400 to-indigo-500 flex items-center justify-center">
                                                    <i class="fas fa-user text-white"></i>
                                                </div>
                                                {% endif %}
                                            </div>
                                            <div>
                                                <h4 class="font-medium text-gray-800">{{ review.user.get_full_name }}</h4>
                                                <div class="flex items-center text-sm text-gray-500">
                                                    <div class="flex text-amber-400 mr-2">
                                                        {% for i in "12345"|make_list %}
                                                        <i class="fas fa-star text-xs {% if forloop.counter > review.rating %}text-gray-300{% endif %}"></i>
                                                        {% endfor %}
                                                    </div>
                                                    <span>{{ review.created_at|date:"M j, Y" }}</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        {% if review.verified %}
                                        <span class="px-2 py-1 bg-emerald-100 text-emerald-800 text-xs rounded-full">
                                            <i class="fas fa-check mr-1"></i>
                                            Verified Student
                                        </span>
                                        {% endif %}
                                    </div>
                                    
                                    <h5 class="font-medium text-gray-800 mb-2">{{ review.title }}</h5>
                                    <p class="text-gray-600 text-sm mb-3">{{ review.comment }}</p>
                                    
                                    <div class="flex items-center text-sm text-gray-500">
                                        <button class="flex items-center mr-4 hover:text-emerald-600">
                                            <i class="far fa-thumbs-up mr-1"></i>
                                            <span>{{ review.likes_count }} helpful</span>
                                        </button>
                                        <button class="flex items-center hover:text-emerald-600">
                                            <i class="far fa-comment mr-1"></i>
                                            <span>Reply</span>
                                        </button>
                                    </div>
                                </div>
                                {% empty %}
                                <div class="text-center py-8">
                                    <i class="fas fa-comments text-3xl text-gray-300 mb-4"></i>
                                    <p class="text-gray-600">No reviews yet. Be the first to review!</p>
                                </div>
                                {% endfor %}
                            </div>
                            
                            <!-- View All Reviews -->
                            {% if program.review_count > 5 %}
                            <div class="mt-8 text-center">
                                <a href="#" class="btn btn-outline">
                                    <i class="fas fa-list mr-2"></i>
                                    View All Reviews
                                </a>
                            </div>
                            {% endif %}
                        </div>
                    </section>

                    <!-- FAQ Section -->
                    <section id="faq" class="mb-12">
                        <div class="bg-white rounded-2xl shadow-lg p-8">
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">Frequently Asked Questions</h2>
                            
                            <div class="space-y-4">
                                {% for faq in program.faqs.all %}
                                <div class="border border-gray-200 rounded-xl overflow-hidden">
                                    <button class="faq-question w-full px-6 py-4 text-left font-medium text-gray-800 hover:bg-gray-50 flex justify-between items-center">
                                        <span>{{ faq.question }}</span>
                                        <i class="fas fa-chevron-down text-gray-400 transition-transform duration-200"></i>
                                    </button>
                                    <div class="faq-answer px-6 py-4 bg-gray-50 hidden">
                                        <p class="text-gray-600">{{ faq.answer }}</p>
                                    </div>
                                </div>
                                {% empty %}
                                <div class="text-center py-8">
                                    <i class="fas fa-question-circle text-3xl text-gray-300 mb-4"></i>
                                    <p class="text-gray-600">No FAQs available for this program.</p>
                                </div>
                                {% endfor %}
                            </div>
                            
                            <!-- Ask Question -->
                            <div class="mt-8 bg-gray-50 rounded-xl p-6">
                                <h3 class="font-bold text-gray-800 mb-3">Still have questions?</h3>
                                <p class="text-gray-600 mb-4">Ask the instructor or other students in the community.</p>
                                <button class="btn btn-primary">
                                    <i class="fas fa-question-circle mr-2"></i>
                                    Ask a Question
                                </button>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Right Column -->
                <div class="lg:w-1/3">
                    <!-- Requirements Card -->
                    <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                        <h3 class="font-bold text-gray-800 mb-4">Requirements</h3>
                        <div class="space-y-3">
                            {% for requirement in program.requirements.all %}
                            <div class="flex items-start">
                                <div class="flex-shrink-0 w-6 h-6 rounded-full bg-emerald-100 flex items-center justify-center mr-3 mt-1">
                                    <i class="fas fa-check text-emerald-600 text-xs"></i>
                                </div>
                                <span class="text-gray-700 text-sm">{{ requirement.description }}</span>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- Features Card -->
                    <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                        <h3 class="font-bold text-gray-800 mb-4">This Program Includes</h3>
                        <div class="space-y-3">
                            {% for feature in program.features.all %}
                            <div class="flex items-center">
                                <div class="w-8 h-8 rounded-lg {{ feature.color_class }} flex items-center justify-center mr-3">
                                    <i class="{{ feature.icon }} text-white"></i>
                                </div>
                                <div>
                                    <div class="font-medium text-gray-800 text-sm">{{ feature.title }}</div>
                                    <div class="text-xs text-gray-600">{{ feature.description }}</div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- Certificate Preview -->
                    {% if program.is_certified %}
                    <div class="bg-gradient-to-r from-emerald-500 to-teal-600 rounded-2xl p-6 text-white mb-6">
                        <div class="text-center mb-4">
                            <i class="fas fa-certificate text-4xl mb-3"></i>
                            <h3 class="text-xl font-bold mb-2">Certificate of Completion</h3>
                            <p class="text-emerald-100 text-sm">Earn a certificate upon completing this program</p>
                        </div>
                        <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">
                            <div class="text-center">
                                <div class="text-sm text-emerald-100 mb-2">Sample Certificate</div>
                                <div class="h-40 bg-white/20 rounded flex items-center justify-center">
                                    <div class="text-center">
                                        <i class="fas fa-award text-3xl mb-2"></i>
                                        <div class="text-sm">Certificate Preview</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- Related Programs -->
                    <div class="bg-white rounded-2xl shadow-lg p-6">
                        <h3 class="font-bold text-gray-800 mb-4">Related Programs</h3>
                        <div class="space-y-4">
                            {% for related in related_programs %}
                            <a href="{% url 'programs:detail' related.id %}" class="group flex items-center space-x-3 p-3 hover:bg-gray-50 rounded-lg transition-colors">
                                <div class="w-16 h-16 rounded-lg overflow-hidden flex-shrink-0">
                                    {% if related.image %}
                                    <img src="{{ related.image.url }}" 
                                         alt="{{ related.title }}" 
                                         class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300">
                                    {% else %}
                                    <div class="w-full h-full bg-gradient-to-r from-emerald-400 to-teal-500 flex items-center justify-center">
                                        <i class="fas fa-leaf text-white"></i>
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-medium text-gray-800 group-hover:text-emerald-600">{{ related.title }}</h4>
                                    <div class="flex items-center text-xs text-gray-500 mt-1">
                                        <i class="fas fa-star text-amber-400 mr-1"></i>
                                        <span>{{ related.rating }}</span>
                                        <span class="mx-1">•</span>
                                        <i class="far fa-clock mr-1"></i>
                                        <span>{{ related.duration }} weeks</span>
                                    </div>
                                </div>
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Enrollment Modal -->
<div id="enrollmentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto">
        <div class="p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-800">Enroll in Program</h3>
                <button class="text-gray-400 hover:text-gray-600 close-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-6">
                <div class="flex items-center space-x-4 mb-4">
                    <div class="w-16 h-16 rounded-lg overflow-hidden">
                        {% if program.image %}
                        <img src="{{ program.image.url }}" 
                             alt="{{ program.title }}" 
                             class="w-full h-full object-cover">
                        {% else %}
                        <div class="w-full h-full bg-gradient-to-r from-emerald-400 to-teal-500 flex items-center justify-center">
                            <i class="fas fa-leaf text-white"></i>
                        </div>
                        {% endif %}
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-800">{{ program.title|truncatechars:40 }}</h4>
                        <p class="text-sm text-gray-600">{{ program.instructor.name }}</p>
                    </div>
                </div>
                
                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-gray-700">Price</span>
                        <span class="text-2xl font-bold text-emerald-600">
                            {% if program.is_free %}Free{% else %}${{ program.price }}{% endif %}
                        </span>
                    </div>
                    {% if not program.is_free %}
                    <div class="text-sm text-gray-600">
                        <i class="fas fa-shield-alt text-emerald-500 mr-1"></i>
                        30-day money-back guarantee
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <form id="enrollmentForm" class="space-y-4">
                {% if not program.is_free %}
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Payment Method</label>
                    <div class="space-y-2">
                        <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                            <input type="radio" name="payment_method" value="card" class="h-4 w-4 text-emerald-600" checked>
                            <div class="ml-3">
                                <span class="font-medium text-gray-800">Credit/Debit Card</span>
                                <div class="flex items-center mt-1">
                                    <i class="fab fa-cc-visa text-blue-600 mr-2"></i>
                                    <i class="fab fa-cc-mastercard text-red-600 mr-2"></i>
                                    <i class="fab fa-cc-amex text-blue-800 mr-2"></i>
                                    <i class="fab fa-cc-discover text-orange-600"></i>
                                </div>
                            </div>
                        </label>
                        <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                            <input type="radio" name="payment_method" value="paypal" class="h-4 w-4 text-emerald-600">
                            <div class="ml-3">
                                <span class="font-medium text-gray-800">PayPal</span>
                                <div class="mt-1">
                                    <i class="fab fa-paypal text-blue-700"></i>
                                </div>
                            </div>
                        </label>
                    </div>
                </div>
                {% endif %}
                
                <div class="flex items-start">
                    <input type="checkbox" id="terms" class="mt-1 h-4 w-4 text-emerald-600">
                    <label for="terms" class="ml-2 text-sm text-gray-700">
                        I agree to the 
                        <a href="#" class="text-emerald-600 hover:text-emerald-700">Terms of Service</a>
                        and understand the 
                        <a href="#" class="text-emerald-600 hover:text-emerald-700">Refund Policy</a>
                    </label>
                </div>
                
                <div class="flex space-x-3">
                    <button type="button" class="flex-1 btn btn-outline close-modal">
                        Cancel
                    </button>
                    <button type="submit" class="flex-1 btn btn-primary">
                        {% if program.is_free %}Enroll Free{% else %}Complete Payment{% endif %}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Program detail page functionality
    document.addEventListener('DOMContentLoaded', function() {
        // Tab navigation
        const tabLinks = document.querySelectorAll('.tab-link');
        const sections = document.querySelectorAll('section[id]');
        
        // Update active tab based on scroll
        window.addEventListener('scroll', function() {
            let current = '';
            
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                if (scrollY >= (sectionTop - 100)) {
                    current = section.getAttribute('id');
                }
            });
            
            tabLinks.forEach(link => {
                link.classList.remove('text-emerald-600', 'border-b-2', 'border-emerald-600');
                if (link.getAttribute('href') === `#${current}`) {
                    link.classList.add('text-emerald-600', 'border-b-2', 'border-emerald-600');
                }
            });
        });
        
        // Smooth scroll for tab links
        tabLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetSection = document.querySelector(targetId);
                
                if (targetSection) {
                    window.scrollTo({
                        top: targetSection.offsetTop - 100,
                        behavior: 'smooth'
                    });
                }
            });
        });
        
        // FAQ accordion
        const faqQuestions = document.querySelectorAll('.faq-question');
        faqQuestions.forEach(question => {
            question.addEventListener('click', function() {
                const answer = this.nextElementSibling;
                const icon = this.querySelector('i');
                
                // Toggle answer
                answer.classList.toggle('hidden');
                
                // Rotate icon
                icon.classList.toggle('rotate-180');
                
                // Close other FAQs
                faqQuestions.forEach(otherQuestion => {
                    if (otherQuestion !== this) {
                        otherQuestion.nextElementSibling.classList.add('hidden');
                        otherQuestion.querySelector('i').classList.remove('rotate-180');
                    }
                });
            });
        });
        
        // Module completion toggle
        const moduleCheckboxes = document.querySelectorAll('.module-card input[type="checkbox"]');
        moduleCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const moduleCard = this.closest('.module-card');
                if (this.checked) {
                    moduleCard.classList.add('completed');
                    moduleCard.classList.remove('current');
                } else {
                    moduleCard.classList.remove('completed');
                }
                
                // Update progress
                updateProgress();
            });
        });
        
        function updateProgress() {
            const totalModules = document.querySelectorAll('.module-card').length;
            const completedModules = document.querySelectorAll('.module-card.completed').length;
            const progress = Math.round((completedModules / totalModules) * 100);
            
            // Update progress display
            const progressElement = document.querySelector('.progress-ring-circle');
            if (progressElement) {
                const circumference = 2 * Math.PI * 45;
                const offset = circumference - (progress / 100) * circumference;
                progressElement.style.strokeDashoffset = offset;
            }
            
            const progressText = document.querySelector('.text-2xl.font-bold.text-emerald-600');
            if (progressText) {
                progressText.textContent = `${progress}%`;
            }
        }
        
        // Enrollment modal
        const enrollmentModal = document.getElementById('enrollmentModal');
        const enrollButtons = document.querySelectorAll('.btn-primary[href*="apply"]');
        const closeModalButtons = document.querySelectorAll('.close-modal');
        
        // Open modal
        enrollButtons.forEach(button => {
            button.addEventListener('click', function(e) {
                if (this.getAttribute('href').includes('apply')) {
                    e.preventDefault();
                    enrollmentModal.classList.remove('hidden');
                    enrollmentModal.classList.add('flex');
                }
            });
        });
        
        // Close modal
        closeModalButtons.forEach(button => {
            button.addEventListener('click', function() {
                enrollmentModal.classList.add('hidden');
                enrollmentModal.classList.remove('flex');
            });
        });
        
        // Close modal when clicking outside
        enrollmentModal.addEventListener('click', function(e) {
            if (e.target === enrollmentModal) {
                enrollmentModal.classList.add('hidden');
                enrollmentModal.classList.remove('flex');
            }
        });
        
        // Enrollment form submission
        document.getElementById('enrollmentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const terms = document.getElementById('terms').checked;
            
            if (!terms) {
                alert('Please agree to the terms and conditions');
                return;
            }
            
            // In a real app, this would process enrollment
            console.log('Enrolling in program:', '{{ program.title }}');
            alert('Successfully enrolled in the program!');
            enrollmentModal.classList.add('hidden');
            enrollmentModal.classList.remove('flex');
            
            // Redirect to program page
            window.location.href = "{% url 'programs:detail' program.id %}";
        });
        
        // Initialize progress
        updateProgress();
    });
</script>
{% endblock %}
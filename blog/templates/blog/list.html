{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Environmental Research & Sustainability Insights | EcoHub Scientific Blog{% endblock %}

{% block meta_description %}Expert environmental research, climate change analysis, renewable energy studies, and sustainable development insights from leading scientists and researchers.{% endblock %}

{% block extra_css %}
<!-- Main Blog CSS Files -->
<link rel="stylesheet" href="{% static 'blog/main.css' %}">
<link rel="stylesheet" href="{% static 'blog/typography.css' %}">
<link rel="stylesheet" href="{% static 'blog/animations.css' %}">
<link rel="stylesheet" href="{% static 'blog/dark-mode.css' %}">

<!-- Font Awesome for Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- Additional Styles -->
<style>
    /* Custom styles for this template */
    .blog-hero-section {
        position: relative;
        overflow: hidden;
    }
    
    .hero-background {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: 
            radial-gradient(circle at 20% 80%, rgba(0, 102, 204, 0.1) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, rgba(0, 168, 107, 0.1) 0%, transparent 50%),
            linear-gradient(135deg, var(--blog-neutral-900) 0%, var(--blog-neutral-800) 100%);
        z-index: 1;
    }
    
    .hero-content {
        position: relative;
        z-index: 2;
    }
    
    /* Animation delays for cards */
    .blog-card {
        opacity: 0;
        transform: translateY(20px);
        animation: fadeInUp 0.6s ease forwards;
    }
    
    .blog-card:nth-child(1) { animation-delay: 0.1s; }
    .blog-card:nth-child(2) { animation-delay: 0.2s; }
    .blog-card:nth-child(3) { animation-delay: 0.3s; }
    .blog-card:nth-child(4) { animation-delay: 0.4s; }
    .blog-card:nth-child(5) { animation-delay: 0.5s; }
    .blog-card:nth-child(6) { animation-delay: 0.6s; }
    .blog-card:nth-child(7) { animation-delay: 0.7s; }
    .blog-card:nth-child(8) { animation-delay: 0.8s; }
    .blog-card:nth-child(9) { animation-delay: 0.9s; }
    
    /* Print styles */
    @media print {
        .no-print {
            display: none !important;
        }
        
        .blog-card {
            break-inside: avoid;
            page-break-inside: avoid;
        }
    }
    
    /* Fix for category progress bars */
    .category-progress .progress-fill {
        transition: width 0.3s ease;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .featured-research-grid {
            grid-template-columns: 1fr !important;
        }
        
        .secondary-featured-grid {
            grid-template-columns: 1fr !important;
        }
        
        .metrics-grid {
            grid-template-columns: repeat(2, 1fr) !important;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="blog-container">
    <!-- Hero Section -->
    <section class="blog-hero-section">
        <div class="hero-background"></div>
        <div class="container mx-auto px-4 py-24 relative z-10">
            <div class="max-w-6xl mx-auto">
                <!-- Breadcrumb -->
                <nav class="breadcrumb-nav mb-8">
                    <ol class="flex items-center space-x-2 text-sm">
                        <li>
                            <a href="/" class="text-blog-neutral-300 hover:text-white transition-colors">
                                <i class="fas fa-home mr-1"></i> Home
                            </a>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-chevron-right mx-2 text-blog-neutral-500 text-xs"></i>
                            <span class="text-white font-medium">Research Blog</span>
                        </li>
                    </ol>
                </nav>
                
                <!-- Hero Content -->
                <div class="text-center mb-16">
                    <h1 class="hero-title mb-6">
                        <span class="block text-5xl md:text-6xl lg:text-7xl font-bold text-white leading-tight">
                            Environmental
                            <span class="text-blog-primary">Research</span>
                        </span>
                        <span class="block text-4xl md:text-5xl font-light text-blog-neutral-300 mt-2">
                            & Scientific Insights
                        </span>
                    </h1>
                    
                    <p class="hero-subtitle text-xl md:text-2xl text-blog-neutral-300 max-w-3xl mx-auto leading-relaxed mb-10">
                        Data-driven analysis, peer-reviewed research, and actionable insights on climate change, 
                        renewable energy, conservation, and sustainable development.
                    </p>
                </div>
                
                <!-- Advanced Search -->
                <div class="max-w-4xl mx-auto mb-16">
                    <form action="{% url 'blog:search' %}" method="get" class="search-form">
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                <i class="fas fa-search text-blog-neutral-400 text-lg"></i>
                            </div>
                            <input type="search" 
                                   name="q" 
                                   placeholder="Search research articles..." 
                                   class="search-input pl-12 pr-40"
                                   value="{{ search_query|default:'' }}">
                            <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                                <button type="submit" class="search-button">
                                    <i class="fas fa-search mr-2"></i> Search
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                
                <!-- Key Metrics -->
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value">
                            {% if page_obj %}
                                {{ page_obj.paginator.count|intcomma }}
                            {% elif total_posts %}
                                {{ total_posts|intcomma }}
                            {% else %}
                                0
                            {% endif %}
                        </div>
                        <div class="metric-label">Research Articles</div>
                        <div class="metric-trend positive">
                            <i class="fas fa-arrow-up mr-1"></i>
                            New daily
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-value">
                            {% if total_views %}
                                {{ total_views|intcomma }}
                            {% else %}
                                0
                            {% endif %}
                        </div>
                        <div class="metric-label">Total Views</div>
                        <div class="metric-trend positive">
                            <i class="fas fa-arrow-up mr-1"></i>
                            +15% growth
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-value">
                            {% if categories %}
                                {{ categories.count|intcomma }}
                            {% else %}
                                0
                            {% endif %}
                        </div>
                        <div class="metric-label">Research Fields</div>
                        <div class="metric-trend neutral">
                            <i class="fas fa-minus mr-1"></i>
                            Updated weekly
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-value">98%</div>
                        <div class="metric-label">Peer Reviewed</div>
                        <div class="metric-trend positive">
                            <i class="fas fa-check mr-1"></i>
                            Quality assured
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Featured Research Section -->
    <section class="featured-research-section py-20 bg-gradient-to-b from-white to-blog-neutral-50">
        <div class="container mx-auto px-4">
            <div class="section-header mb-12">
                <div class="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4">
                    <div>
                        <h2 class="section-title">
                            <span class="section-title-prefix">Featured Research</span>
                            Editor's Picks
                        </h2>
                        <p class="section-subtitle">
                            Curated selection of groundbreaking environmental research and analysis
                        </p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <a href="{% url 'blog:list' %}" class="view-all-link">
                            View All Articles
                            <i class="fas fa-arrow-right ml-2"></i>
                        </a>
                    </div>
                </div>
                
                <!-- Research Categories -->
                <div class="research-categories">
                    <div class="category-filters">
                        <a href="{% url 'blog:list' %}" 
                           class="category-filter {% if not current_category and not current_tag %}active{% endif %}">
                            <i class="fas fa-layer-group mr-2"></i>
                            All Research
                        </a>
                        {% if categories %}
                            {% for category in categories|slice:":4" %}
                            <a href="{% url 'blog:category_detail' category.slug %}" 
                               class="category-filter {% if current_category == category.slug %}active{% endif %}">
                                <i class="fas {{ category.icon|default:'fa-leaf' }} mr-2"></i>
                                {{ category.name }}
                            </a>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Featured Research Grid -->
            <div class="featured-research-grid">
                {% if featured_posts and featured_posts.first %}
                <!-- Main Featured Post -->
                <article class="main-featured-post">
                    {% with featured_posts.first as post %}
                    <div class="featured-post-content">
                        <!-- Research Badges -->
                        <div class="research-badges">
                            <span class="research-badge peer-reviewed">
                                <i class="fas fa-certificate mr-1"></i>
                                Peer Reviewed
                            </span>
                            <span class="research-badge open-access">
                                <i class="fas fa-unlock mr-1"></i>
                                Open Access
                            </span>
                            {% if post.is_featured %}
                            <span class="research-badge trending">
                                <i class="fas fa-fire mr-1"></i>
                                Featured
                            </span>
                            {% endif %}
                        </div>
                        
                        <!-- Post Meta -->
                        <div class="post-meta">
                            {% if post.category %}
                            <span class="post-category">{{ post.category.name }}</span>
                            {% endif %}
                            {% if post.published_at %}
                            <span class="post-date">{{ post.published_at|date:"F j, Y" }}</span>
                            {% endif %}
                            <span class="post-read-time">
                                <i class="far fa-clock mr-1"></i>
                                {{ post.read_time|default:"5" }} min read
                            </span>
                        </div>
                        
                        <!-- Title -->
                        <h3 class="post-title">
                            <a href="{% url 'blog:detail' post.slug %}">{{ post.title }}</a>
                        </h3>
                        
                        <!-- Excerpt -->
                        <p class="post-excerpt">{{ post.excerpt|default:"" }}</p>
                        
                        <!-- Research Highlights -->
                        <div class="research-highlights">
                            <h4 class="highlights-title">Key Findings:</h4>
                            <ul class="highlights-list">
                                <li class="highlight-item">
                                    <i class="fas fa-check-circle text-blog-success mr-2"></i>
                                    Significant reduction in carbon emissions
                                </li>
                                <li class="highlight-item">
                                    <i class="fas fa-check-circle text-blog-success mr-2"></i>
                                    40% increase in renewable energy adoption
                                </li>
                                <li class="highlight-item">
                                    <i class="fas fa-check-circle text-blog-success mr-2"></i>
                                    Positive economic impact on local communities
                                </li>
                            </ul>
                        </div>
                        
                        <!-- Author & Actions -->
                        <div class="post-footer">
                            <div class="author-info">
                                <div class="author-avatar">
                                    {% if post.author.profile_image %}
                                    <img src="{{ post.author.profile_image.url }}" 
                                         alt="{{ post.author.get_full_name }}"
                                         loading="lazy">
                                    {% else %}
                                    <div class="avatar-placeholder">
                                        {{ post.author.get_full_name|first|upper }}
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="author-details">
                                    <div class="author-name">{{ post.author.get_full_name }}</div>
                                    <div class="author-credentials">
                                        {{ post.author.bio|default:"Environmental Research Scientist"|truncatewords:10 }}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="post-actions">
                                <button class="action-button save-button" 
                                        data-post-id="{{ post.id }}"
                                        data-liked="{% if request.user.is_authenticated %}{% if post in user_saved_posts %}true{% else %}false{% endif %}{% else %}false{% endif %}">
                                    <i class="far fa-bookmark"></i>
                                    Save
                                </button>
                                <button class="action-button share-button"
                                        data-title="{{ post.title }}"
                                        data-url="{% url 'blog:detail' post.slug %}">
                                    <i class="fas fa-share-alt"></i>
                                    Share
                                </button>
                                <a href="{% url 'blog:detail' post.slug %}" class="read-button">
                                    Read Research
                                    <i class="fas fa-arrow-right ml-2"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Featured Image -->
                    <div class="featured-post-image">
                        {% if post.featured_image %}
                        <img src="{{ post.featured_image.url }}" 
                             alt="{{ post.title }}"
                             loading="lazy"
                             class="featured-image">
                        {% else %}
                        <div class="image-placeholder">
                            <i class="fas fa-microscope text-6xl text-blog-neutral-400"></i>
                        </div>
                        {% endif %}
                    </div>
                    {% endwith %}
                </article>
                {% endif %}
                
                <!-- Secondary Featured Posts -->
                <div class="secondary-featured-grid">
                    {% if featured_posts %}
                        {% for post in featured_posts|slice:"1:4" %}
                        <article class="secondary-featured-post">
                            <div class="secondary-post-image">
                                {% if post.featured_image %}
                                <img src="{{ post.featured_image.url }}" 
                                     alt="{{ post.title }}"
                                     loading="lazy">
                                {% else %}
                                <div class="image-placeholder">
                                    <i class="fas fa-seedling text-4xl text-blog-neutral-400"></i>
                                </div>
                                {% endif %}
                            </div>
                            
                            <div class="secondary-post-content">
                                <div class="post-meta">
                                    {% if post.category %}
                                    <span class="post-category">{{ post.category.name }}</span>
                                    {% endif %}
                                    {% if post.published_at %}
                                    <span class="post-date">{{ post.published_at|date:"M j, Y" }}</span>
                                    {% endif %}
                                </div>
                                
                                <h4 class="post-title">
                                    <a href="{% url 'blog:detail' post.slug %}">{{ post.title|truncatewords:8 }}</a>
                                </h4>
                                
                                <p class="post-excerpt">{{ post.excerpt|default:""|truncatewords:25 }}</p>
                                
                                <div class="post-footer">
                                    <div class="author-info">
                                        <div class="author-avatar small">
                                            {% if post.author.profile_image %}
                                            <img src="{{ post.author.profile_image.url }}" 
                                                 alt="{{ post.author.get_full_name }}"
                                                 loading="lazy">
                                            {% else %}
                                            <div class="avatar-placeholder small">
                                                {{ post.author.get_full_name|first|upper }}
                                            </div>
                                            {% endif %}
                                        </div>
                                        <div class="author-name">{{ post.author.get_full_name|truncatechars:15 }}</div>
                                    </div>
                                    
                                    <div class="post-stats">
                                        <span class="stat-item">
                                            <i class="far fa-eye mr-1"></i>
                                            {{ post.views|default:0|intcomma }}
                                        </span>
                                        <span class="stat-item">
                                            <i class="far fa-comment mr-1"></i>
                                            {{ post.comment_count|default:0|intcomma }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </article>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>
    </section>
    
    <!-- Main Content Area -->
    <main class="main-content-area" id="main-content">
        <div class="container mx-auto px-4 py-16">
            <div class="flex flex-col lg:flex-row gap-12">
                <!-- Primary Content -->
                <div class="lg:w-2/3">
                    <!-- Content Header -->
                    <div class="content-header">
                        <div class="header-main">
                            <h2 class="content-title">Latest Research & Analysis</h2>
                            <p class="content-subtitle">
                                Cutting-edge environmental research published by our global network of scientists
                            </p>
                        </div>
                        
                        <!-- Content Controls -->
                        <div class="content-controls">
                            <!-- Sort Controls -->
                            <div class="sort-controls">
                                <select class="sort-select" onchange="window.location.href='?sort=' + this.value">
                                    <option value="-published_at" {% if sort_by == '-published_at' %}selected{% endif %}>Newest First</option>
                                    <option value="published_at" {% if sort_by == 'published_at' %}selected{% endif %}>Oldest First</option>
                                    <option value="-views" {% if sort_by == '-views' %}selected{% endif %}>Most Viewed</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Filter Tabs -->
                    <div class="content-controls mb-6">
                        <div class="category-filters">
                            <a href="{% url 'blog:list' %}" 
                               class="category-filter {% if not current_category and not current_tag %}active{% endif %}">
                                All Articles
                            </a>
                            {% if categories %}
                                {% for category in categories|slice:":5" %}
                                <a href="{% url 'blog:category_detail' category.slug %}" 
                                   class="category-filter {% if current_category == category.slug %}active{% endif %}">
                                    {{ category.name }}
                                </a>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Blog Posts Grid -->
                    <div class="blog-posts-grid view-grid">
                        {% if page_obj %}
                            {% for post in page_obj %}
                            <article class="blog-card" 
                                     data-category="{% if post.category %}{{ post.category.slug }}{% endif %}"
                                     data-date="{% if post.published_at %}{{ post.published_at|date:'Y-m-d' }}{% endif %}"
                                     data-views="{{ post.views|default:0 }}"
                                     data-likes="{{ post.likes|default:0 }}">
                                <!-- Card Header -->
                                <div class="card-header">
                                    <!-- Category & Badges -->
                                    <div class="card-badges">
                                        {% if post.category %}
                                        <a href="{% url 'blog:category_detail' post.category.slug %}" 
                                           class="card-category">
                                            {{ post.category.name }}
                                        </a>
                                        {% endif %}
                                        
                                        {% if post.is_featured %}
                                        <span class="badge premium">
                                            <i class="fas fa-star mr-1"></i>
                                            Featured
                                        </span>
                                        {% endif %}
                                        
                                        {% if post.published_at %}
                                            {% with post.published_at|timesince as time_since %}
                                                {% if time_since|slice:":1" <= '7' or "week" in time_since %}
                                                <span class="badge trending">
                                                    <i class="fas fa-bolt mr-1"></i>
                                                    New
                                                </span>
                                                {% endif %}
                                            {% endwith %}
                                        {% endif %}
                                        
                                        {% if post.views|default:0 > 1000 %}
                                        <span class="badge trending">
                                            <i class="fas fa-fire mr-1"></i>
                                            Popular
                                        </span>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Save Button -->
                                    <button class="card-save-button"
                                            data-post-id="{{ post.id }}"
                                            data-liked="false">
                                        <i class="far fa-bookmark"></i>
                                    </button>
                                </div>
                                
                                <!-- Card Image -->
                                <div class="card-image">
                                    <a href="{% url 'blog:detail' post.slug %}">
                                        {% if post.featured_image %}
                                        <img src="{{ post.featured_image.url }}" 
                                             alt="{{ post.title }}"
                                             loading="lazy"
                                             class="post-image">
                                        {% else %}
                                        <div class="image-placeholder">
                                            <i class="fas fa-microscope text-4xl text-blog-neutral-400"></i>
                                        </div>
                                        {% endif %}
                                    </a>
                                </div>
                                
                                <!-- Card Content -->
                                <div class="card-content">
                                    <!-- Title -->
                                    <h3 class="card-title">
                                        <a href="{% url 'blog:detail' post.slug %}">
                                            {{ post.title }}
                                        </a>
                                    </h3>
                                    
                                    <!-- Excerpt -->
                                    <p class="card-excerpt">
                                        {{ post.excerpt|default:""|truncatewords:30 }}
                                    </p>
                                    
                                    <!-- Metadata -->
                                    <div class="card-metadata">
                                        {% if post.published_at %}
                                        <div class="metadata-item">
                                            <i class="far fa-calendar mr-1"></i>
                                            <span>{{ post.published_at|date:"M j, Y" }}</span>
                                        </div>
                                        {% endif %}
                                        
                                        <div class="metadata-item">
                                            <i class="far fa-clock mr-1"></i>
                                            <span>{{ post.read_time|default:"5" }} min read</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Author -->
                                    <div class="card-author">
                                        <div class="author-avatar">
                                            {% if post.author.profile_image %}
                                            <img src="{{ post.author.profile_image.url }}" 
                                                 alt="{{ post.author.get_full_name }}"
                                                 loading="lazy">
                                            {% else %}
                                            <div class="avatar-placeholder">
                                                {{ post.author.get_full_name|first|upper }}
                                            </div>
                                            {% endif %}
                                        </div>
                                        <div class="author-details">
                                            <div class="author-name">{{ post.author.get_full_name }}</div>
                                            <div class="author-title">{{ post.author.position|default:"Researcher" }}</div>
                                        </div>
                                    </div>
                                    
                                    <!-- Stats -->
                                    <div class="card-stats">
                                        <div class="stat">
                                            <i class="far fa-eye mr-1"></i>
                                            <span>{{ post.views|default:0|intcomma }}</span>
                                        </div>
                                        
                                        <div class="stat">
                                            <i class="far fa-heart mr-1"></i>
                                            <span>{{ post.likes|default:0|intcomma }}</span>
                                        </div>
                                        
                                        <div class="stat">
                                            <i class="far fa-comment mr-1"></i>
                                            <span>{{ post.comment_count|default:0|intcomma }}</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Tags -->
                                    {% if post.tags.all %}
                                    <div class="card-tags">
                                        {% for tag in post.tags.all|slice:":3" %}
                                        <a href="{% url 'blog:tag_detail' tag.slug %}" class="tag">
                                            #{{ tag.name }}
                                        </a>
                                        {% endfor %}
                                        
                                        {% if post.tags.count > 3 %}
                                        <span class="tag-more">+{{ post.tags.count|add:"-3" }} more</span>
                                        {% endif %}
                                    </div>
                                    {% endif %}
                                    
                                    <!-- Actions -->
                                    <div class="card-actions">
                                        <a href="{% url 'blog:detail' post.slug %}" class="read-more-button">
                                            Read Article
                                            <i class="fas fa-arrow-right ml-2"></i>
                                        </a>
                                        
                                        <div class="action-buttons">
                                            <button class="action-button share-button"
                                                    data-title="{{ post.title }}"
                                                    data-url="{% url 'blog:detail' post.slug %}">
                                                <i class="fas fa-share-alt"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </article>
                            {% endfor %}
                        {% else %}
                        <!-- No Posts State -->
                        <div class="no-posts-state">
                            <div class="no-posts-content">
                                <i class="fas fa-microscope text-6xl text-blog-neutral-300 mb-6"></i>
                                <h3 class="text-2xl font-bold text-blog-neutral-800 mb-4">
                                    No Research Articles Found
                                </h3>
                                <p class="text-blog-neutral-600 mb-8 max-w-md mx-auto">
                                    {% if search_query %}
                                    We couldn't find any articles matching "{{ search_query }}". 
                                    Try adjusting your search terms or check back soon for new research publications.
                                    {% else %}
                                    We're currently updating our research database. 
                                    Check back soon for groundbreaking environmental studies.
                                    {% endif %}
                                </p>
                                <a href="{% url 'blog:list' %}" class="reset-filters-button">
                                    <i class="fas fa-redo mr-2"></i>
                                    View All Articles
                                </a>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- Pagination -->
                    {% if page_obj and page_obj.paginator.num_pages > 1 %}
                    <nav class="pagination-container">
                        <div class="pagination-content">
                            <!-- Page Info -->
                            <div class="page-info">
                                <span class="page-info-text">
                                    Showing 
                                    <span class="font-medium">{{ page_obj.start_index|default:1 }}</span>
                                    â€“
                                    <span class="font-medium">{{ page_obj.end_index|default:page_obj|length }}</span>
                                    of 
                                    <span class="font-medium">{{ page_obj.paginator.count }}</span>
                                    results
                                </span>
                            </div>
                            
                            <!-- Pagination Controls -->
                            <div class="pagination-controls">
                                {% if page_obj.has_previous %}
                                <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_tag %}&tag={{ current_tag }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}" 
                                   class="pagination-button prev">
                                    <i class="fas fa-chevron-left mr-2"></i>
                                    Previous
                                </a>
                                {% else %}
                                <span class="pagination-button prev disabled">
                                    <i class="fas fa-chevron-left mr-2"></i>
                                    Previous
                                </span>
                                {% endif %}
                                
                                <!-- Page Numbers -->
                                <div class="page-numbers">
                                    {% for num in page_obj.paginator.page_range %}
                                        {% if page_obj.number == num %}
                                        <span class="page-number active">{{ num }}</span>
                                        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                                        <a href="?page={{ num }}{% if search_query %}&q={{ search_query }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_tag %}&tag={{ current_tag }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}" 
                                           class="page-number">
                                            {{ num }}
                                        </a>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                
                                {% if page_obj.has_next %}
                                <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_tag %}&tag={{ current_tag }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}" 
                                   class="pagination-button next">
                                    Next
                                    <i class="fas fa-chevron-right ml-2"></i>
                                </a>
                                {% else %}
                                <span class="pagination-button next disabled">
                                    Next
                                    <i class="fas fa-chevron-right ml-2"></i>
                                </span>
                                {% endif %}
                            </div>
                        </div>
                    </nav>
                    {% endif %}
                </div>
                
                <!-- Sidebar -->
                <aside class="lg:w-1/3 sidebar-area">
                    <div class="sticky-sidebar">
                        <!-- Categories Widget -->
                        <div class="sidebar-widget categories-widget">
                            <div class="widget-header">
                                <h3 class="widget-title">
                                    <i class="fas fa-tags mr-2"></i>
                                    Research Categories
                                </h3>
                                <a href="{% url 'blog:list' %}" class="widget-action">
                                    View All
                                    <i class="fas fa-arrow-right ml-1"></i>
                                </a>
                            </div>
                            <div class="widget-content">
                                <div class="category-list">
                                    {% if categories %}
                                        {% for category in categories %}
                                        <a href="{% url 'blog:category_detail' category.slug %}" 
                                           class="category-item {% if current_category == category.slug %}active{% endif %}">
                                            <div class="category-info">
                                                <span class="category-name">{{ category.name }}</span>
                                                <span class="category-count">{{ category.post_count|default:"0" }}</span>
                                            </div>
                                        </a>
                                        {% endfor %}
                                    {% else %}
                                        <div class="no-categories">
                                            <p class="text-sm text-blog-neutral-500">No categories available</p>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Popular Posts Widget -->
                        <div class="sidebar-widget popular-widget">
                            <div class="widget-header">
                                <h3 class="widget-title">
                                    <i class="fas fa-fire mr-2"></i>
                                    Trending This Week
                                </h3>
                                <a href="{% url 'blog:list' %}?sort=-views" class="widget-action">
                                    View All
                                    <i class="fas fa-arrow-right ml-1"></i>
                                </a>
                            </div>
                            <div class="widget-content">
                                <div class="popular-posts">
                                    {% if popular_posts %}
                                        {% for post in popular_posts %}
                                        <a href="{% url 'blog:detail' post.slug %}" class="popular-post">
                                            <div class="post-rank">
                                                <span class="rank-number">{{ forloop.counter }}</span>
                                            </div>
                                            <div class="post-info">
                                                <div class="post-title">{{ post.title|truncatewords:6 }}</div>
                                                <div class="post-meta">
                                                    <span class="post-views">{{ post.views|default:0|intcomma }} views</span>
                                                </div>
                                            </div>
                                        </a>
                                        {% endfor %}
                                    {% else %}
                                    <div class="no-posts">
                                        <i class="far fa-newspaper text-3xl text-blog-neutral-400 mb-3"></i>
                                        <p class="text-sm text-blog-neutral-500">No trending posts yet</p>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tags Widget -->
                        <div class="sidebar-widget tags-widget">
                            <div class="widget-header">
                                <h3 class="widget-title">
                                    <i class="fas fa-hashtag mr-2"></i>
                                    Popular Topics
                                </h3>
                            </div>
                            <div class="widget-content">
                                <div class="tags-cloud">
                                    {% if tags %}
                                        {% for tag in tags|slice:":15" %}
                                        <a href="{% url 'blog:tag_detail' tag.slug %}" class="tag-cloud-item">
                                            #{{ tag.name }}
                                            <span class="tag-count">{{ tag.post_count|default:"0" }}</span>
                                        </a>
                                        {% endfor %}
                                    {% else %}
                                    <p class="text-sm text-blog-neutral-500 text-center py-4">No tags yet</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </main>
</div>

<!-- Share Modal -->
<div class="share-modal" id="shareModal" style="display: none;">
    <div class="modal-overlay" onclick="closeShareModal()"></div>
    <div class="modal-content share-modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Share Article</h3>
            <button class="modal-close" onclick="closeShareModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="modal-body">
            <div class="share-options">
                <button class="share-option" onclick="shareTo('twitter')">
                    <div class="share-icon twitter">
                        <i class="fab fa-twitter"></i>
                    </div>
                    <div class="share-label">Twitter</div>
                </button>
                
                <button class="share-option" onclick="shareTo('facebook')">
                    <div class="share-icon facebook">
                        <i class="fab fa-facebook-f"></i>
                    </div>
                    <div class="share-label">Facebook</div>
                </button>
                
                <button class="share-option" onclick="shareTo('linkedin')">
                    <div class="share-icon linkedin">
                        <i class="fab fa-linkedin-in"></i>
                    </div>
                    <div class="share-label">LinkedIn</div>
                </button>
                
                <button class="share-option" onclick="shareTo('email')">
                    <div class="share-icon email">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <div class="share-label">Email</div>
                </button>
                
                <button class="share-option" onclick="copyLink()">
                    <div class="share-icon copy">
                        <i class="fas fa-copy"></i>
                    </div>
                    <div class="share-label">Copy Link</div>
                </button>
            </div>
            
            <div class="share-link">
                <input type="text" readonly class="link-input" id="shareLinkInput">
                <button class="copy-link-button" onclick="copyLink()">
                    <i class="fas fa-copy"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- Back to Top Button -->
<button class="back-to-top" id="backToTop" onclick="scrollToTop()">
    <i class="fas fa-chevron-up"></i>
</button>

<!-- Reading Progress Bar -->
<div class="reading-progress" id="readingProgress">
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
    </div>
</div>

<!-- JavaScript -->
<script>
// DOM Elements
const backToTop = document.getElementById('backToTop');
const readingProgress = document.getElementById('readingProgress');
const progressFill = document.getElementById('progressFill');
const shareModal = document.getElementById('shareModal');
const shareLinkInput = document.getElementById('shareLinkInput');
const toastContainer = document.getElementById('toastContainer');

// Global variables for sharing
let currentShareTitle = '';
let currentShareUrl = '';

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    // Initialize scroll tracking
    window.addEventListener('scroll', handleScroll);
    
    // Initialize like buttons
    initializeLikeButtons();
    
    // Initialize share buttons
    initializeShareButtons();
    
    // Check scroll position on load
    handleScroll();
    
    // Initialize animations
    initializeAnimations();
});

// Scroll handler
function handleScroll() {
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    const docHeight = document.documentElement.scrollHeight - window.innerHeight;
    const scrollPercent = (scrollTop / docHeight) * 100;
    
    // Update progress bar
    if (progressFill) {
        progressFill.style.width = `${scrollPercent}%`;
    }
    
    // Show/hide back to top button
    if (backToTop) {
        if (scrollTop > 300) {
            backToTop.classList.add('visible');
        } else {
            backToTop.classList.remove('visible');
        }
    }
}

// Scroll to top
function scrollToTop() {
    window.scrollTo({
        top: 0,
        behavior: 'smooth'
    });
}

// Like functionality
function initializeLikeButtons() {
    document.querySelectorAll('.card-save-button, .save-button').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const postId = this.dataset.postId;
            const isLiked = this.dataset.liked === 'true';
            
            if (!postId) return;
            
            // Check if user is authenticated
            if (!isUserAuthenticated()) {
                showToast('Please login to save articles', 'warning');
                window.location.href = '/accounts/login/?next=' + window.location.pathname;
                return;
            }
            
            // Toggle visual state
            this.classList.toggle('saved');
            this.dataset.liked = !isLiked;
            
            // Update icon
            const icon = this.querySelector('i');
            if (icon) {
                if (!isLiked) {
                    icon.className = 'fas fa-bookmark'; // Filled bookmark
                } else {
                    icon.className = 'far fa-bookmark'; // Outline bookmark
                }
            }
            
            // Send API request
            likePost(postId, !isLiked);
        });
    });
}

function likePost(postId, like) {
    const csrfToken = getCookie('csrftoken');
    
    // You need to implement this API endpoint in your Django app
    const apiUrl = `/blog/api/posts/${postId}/like/`; // Update with your actual API endpoint
    
    fetch(apiUrl, {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrfToken,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ like: like }),
        credentials: 'same-origin'
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        if (data.error) {
            showToast(data.error, 'error');
            // Revert visual state on error
            const button = document.querySelector(`[data-post-id="${postId}"]`);
            if (button) {
                button.classList.toggle('saved');
                button.dataset.liked = !like;
            }
        } else {
            showToast(data.status === 'liked' ? 'Article saved!' : 'Article removed from saved', 'success');
            // Update like count in UI
            updateLikeCount(postId, data.likes || 0);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('Error saving article', 'error');
    });
}

function updateLikeCount(postId, count) {
    // Find and update like count in card stats
    const button = document.querySelector(`[data-post-id="${postId}"]`);
    if (button) {
        const card = button.closest('.blog-card');
        if (card) {
            const likeStat = card.querySelector('.card-stats .stat:nth-child(2) span');
            if (likeStat) {
                likeStat.textContent = count.toLocaleString();
            }
        }
    }
}

// Share functionality
function initializeShareButtons() {
    document.querySelectorAll('.share-button').forEach(button => {
        button.addEventListener('click', function() {
            currentShareTitle = this.dataset.title || '';
            currentShareUrl = this.dataset.url || window.location.href;
            
            if (shareLinkInput) {
                shareLinkInput.value = currentShareUrl;
            }
            
            openShareModal();
        });
    });
}

function openShareModal() {
    if (shareModal) {
        shareModal.style.display = 'block';
        document.body.style.overflow = 'hidden';
    }
}

function closeShareModal() {
    if (shareModal) {
        shareModal.style.display = 'none';
        document.body.style.overflow = '';
    }
}

function shareTo(platform) {
    if (!currentShareTitle || !currentShareUrl) return;
    
    const encodedTitle = encodeURIComponent(currentShareTitle);
    const encodedUrl = encodeURIComponent(currentShareUrl);
    let shareUrl = '';
    
    switch(platform) {
        case 'twitter':
            shareUrl = `https://twitter.com/intent/tweet?text=${encodedTitle}&url=${encodedUrl}`;
            break;
        case 'facebook':
            shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`;
            break;
        case 'linkedin':
            shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodedUrl}`;
            break;
        case 'email':
            shareUrl = `mailto:?subject=${encodedTitle}&body=${encodedUrl}`;
            break;
    }
    
    if (shareUrl) {
        window.open(shareUrl, '_blank', 'width=600,height=400');
        closeShareModal();
        showToast('Opening share dialog...', 'info');
    }
}

function copyLink() {
    if (shareLinkInput) {
        shareLinkInput.select();
        shareLinkInput.setSelectionRange(0, 99999);
        
        try {
            document.execCommand('copy');
            showToast('Link copied to clipboard!', 'success');
        } catch (err) {
            // Fallback for modern browsers
            navigator.clipboard.writeText(shareLinkInput.value)
                .then(() => showToast('Link copied to clipboard!', 'success'))
                .catch(() => showToast('Failed to copy link', 'error'));
        }
    }
}

// Animations
function initializeAnimations() {
    // Add animation classes to cards
    const cards = document.querySelectorAll('.blog-card');
    cards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.1}s`;
    });
}

// Toast notifications
function showToast(message, type = 'info') {
    if (!toastContainer) return;
    
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.innerHTML = `
        <div class="toast-content">
            <i class="fas ${getToastIcon(type)} mr-3"></i>
            <span class="toast-message">${message}</span>
        </div>
        <button class="toast-close" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    toastContainer.appendChild(toast);
    
    // Auto-remove after 5 seconds
    setTimeout(() => {
        if (toast.parentNode) {
            toast.classList.add('fade-out');
            setTimeout(() => toast.remove(), 300);
        }
    }, 5000);
}

function getToastIcon(type) {
    switch(type) {
        case 'success': return 'fa-check-circle';
        case 'error': return 'fa-exclamation-circle';
        case 'warning': return 'fa-exclamation-triangle';
        default: return 'fa-info-circle';
    }
}

// Utility functions
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function isUserAuthenticated() {
    // Check if user is authenticated (you might want to implement this properly)
    return document.cookie.includes('sessionid') || document.cookie.includes('csrftoken');
}

// Search functionality
document.querySelectorAll('.search-form').forEach(form => {
    form.addEventListener('submit', function(e) {
        const input = this.querySelector('input[name="q"]');
        if (!input.value.trim()) {
            e.preventDefault();
            showToast('Please enter a search term', 'warning');
            return false;
        }
    });
});

// Close modals on ESC key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeShareModal();
    }
});

// Close modals on overlay click
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('modal-overlay')) {
        closeShareModal();
    }
});
</script>
{% endblock %}